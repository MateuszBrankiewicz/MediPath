<div class="select-component">
  <label [for]="name() || 'select-input'">{{ getTranslatedLabel() }}</label>

  <div class="select-wrapper">
    <input
      [id]="name() || 'select-input'"
      [name]="name()"
      type="text"
      [placeholder]="getTranslatedPlaceholder()"
      [value]="searchTerm()"
      (input)="onInputChange($event)"
      (focus)="onInputFocus()"
      (blur)="onInputBlur()"
      (keydown)="onKeyDown($event)"
      class="select-input"
      [class.error]="hasError()"
      autocomplete="off"
    />

    @if (showDropdownButton()) {
      <button
        type="button"
        class="dropdown-button"
        (mousedown)="onDropdownButtonClick()"
        [class.rotated]="isDropdownOpen()"
      >
        @if (isLoading()) {
          <span class="loading-icon">⟳</span>
        } @else {
          <span class="chevron-icon">▼</span>
        }
      </button>
    }

    @if (isDropdownOpen() && filteredOptions().length > 0) {
      <div class="dropdown-menu">
        @for (option of filteredOptions(); track option.name; let i = $index) {
          <div
            class="dropdown-option"
            [class.selected]="selectedOption()?.name === option.name"
            [class.highlighted]="highlightedIndex() === i"
            (mousedown)="onOptionSelect(option)"
            (mouseenter)="highlightedIndex.set(i)"
          >
            {{ option.name }}
          </div>
        }
      </div>
    }

    @if (
      isDropdownOpen() &&
      filteredOptions().length === 0 &&
      searchTerm() &&
      !isLoading()
    ) {
      <div class="dropdown-menu">
        <div class="dropdown-option disabled">No results found</div>
      </div>
    }

    @if (isLoading()) {
      <div class="dropdown-menu">
        <div class="dropdown-option disabled">Loading...</div>
      </div>
    }
  </div>

  @if (hasError()) {
    <span class="error-message">{{ getErrorMessage() }}</span>
  }
</div>
