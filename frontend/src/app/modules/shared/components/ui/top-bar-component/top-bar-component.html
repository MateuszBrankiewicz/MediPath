<header class="dashboard-header">
  @if (config().pageTitle) {
    <h1>{{ config().pageTitle }}</h1>
  }

  <div class="search-section">
    <div class="search-container">
      <p-input-group class="p-input-group" (click)="toggleSearchExpanded()">
        <p-inputgroup-addon class="search-menu-addon">
          <span class="search-menu-trigger">
            <i class="pi pi-bars"></i>
          </span>
        </p-inputgroup-addon>
        <input
          type="text"
          pInputText
          [placeholder]="'Szukaj'"
          styleClass="w-full"
          class="p-inputtext"
          [(ngModel)]="query"
          [readonly]="true"
        />
        <p-inputgroup-addon>
          <span>
            <i class="pi pi-search"></i>
          </span>
        </p-inputgroup-addon>
      </p-input-group>

      @if (isSearchExpanded()) {
        <div class="expanded-search-section">
          <div class="expanded-search-container">
            <div class="search-filters">
              <p-select
                [options]="categoryOptions()"
                [(ngModel)]="selectedCategory"
                placeholder="-- Category --"
                class="category-select"
                optionLabel="label"
                optionValue="value"
              />
              <input
                type="text"
                pInputText
                placeholder="Location (e.g. Lublin)"
                class="location-input"
                [(ngModel)]="locationQuery"
              />
            </div>

            <div class="search-input-row">
              <div class="main-search-container">
                <i class="pi pi-search search-icon"></i>
                <input
                  type="text"
                  pInputText
                  [placeholder]="getSearchPlaceholder()"
                  class="main-search-input"
                  [(ngModel)]="query"
                />
                <input
                  type="text"
                  pInputText
                  placeholder="Specialization"
                  class="specialization-input"
                  [(ngModel)]="specializationQuery"
                />
              </div>
            </div>

            <p-button
              label="SEARCH"
              class="search-button"
              (onClick)="search()"
            />
          </div>
        </div>
      }
    </div>
  </div>

  <div class="header-actions">
    @if (config().showNotifications) {
      <p-button
        type="button"
        [size]="'small'"
        icon="pi pi-bell"
        [text]="true"
        [rounded]="true"
        [badge]="unreadBadge() ?? undefined"
        class="notification-button"
        (onClick)="onNotificationsButtonClick($event)"
      />
      <p-popover
        #notificationsPopover
        appendTo="body"
        styleClass="notifications-popover"
        [dismissable]="true"
      >
        <div class="notifications-popover__container">
          <div class="notifications-popover__header">
            <h3 class="notifications-popover__title">
              {{ translate("notifications.title") }}
            </h3>
            @if (unreadCount() > 0) {
              <button
                type="button"
                class="notifications-popover__mark-all"
                [disabled]="isMarkingAll()"
                (click)="onMarkAllAsRead()"
              >
                {{ translate("notifications.markAllAsRead") }}
              </button>
            }
          </div>

          @if (notifications().length === 0) {
            <p class="notifications-popover__empty">
              {{ translate("notifications.empty") }}
            </p>
          } @else {
            <ul class="notifications-popover__list">
              @for (notification of notifications(); track $index) {
                <li
                  class="notifications-popover__item"
                  [class.notifications-popover__item--unread]="
                    !notification.read
                  "
                >
                  <button
                    type="button"
                    class="notifications-popover__item-button"
                    (click)="onNotificationSelect(notification)"
                  >
                    <span class="notifications-popover__message">
                      {{ notification.title || notification.content }}
                    </span>
                    <span class="notifications-popover__meta">
                      {{ notification.timestamp | date: "short" }}
                    </span>
                  </button>
                </li>
              }
            </ul>

            <button
              type="button"
              class="notifications-popover__view-all"
              (click)="navigateToNotifications()"
            >
              <span>{{ translate("notifications.viewAll") }}</span>
              <i class="pi pi-arrow-right"></i>
            </button>
          }
        </div>
      </p-popover>
    }

    <div class="user-info" (click)="toggleUserMenu($event)">
      <div class="user-menu-header"></div>
      <span class="user-name">{{ user()?.name }} {{ user()?.surname }}</span>
      <i
        [class]="
          isMenuOpen()
            ? 'chevron-icon pi pi-chevron-up'
            : 'chevron-icon pi pi-chevron-down'
        "
      ></i>
    </div>

    <p-menu #userMenu [model]="menuItems()" [popup]="true" class="menu">
      <ng-template #start>
        <div class="role-select-container">
          <p-select
            [options]="roleOptions()"
            [ngModel]="selectedRole()"
            (ngModelChange)="onRoleChange($event)"
            optionLabel="label"
            optionValue="value"
            placeholder="Select role"
            class="role-select"
          />
        </div>
      </ng-template>
    </p-menu>
  </div>
</header>
