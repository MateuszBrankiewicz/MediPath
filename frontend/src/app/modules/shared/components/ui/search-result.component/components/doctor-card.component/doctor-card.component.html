<div class="doctor-profile">
  <div class="doctor-info">
    <div class="doctor-header">
      <div class="doctor-avatar">
        <img [src]="doctor().photoUrl" [alt]="doctor().name" />
      </div>

      <div class="doctor-details">
        <h2 class="doctor-name">{{ doctor().name }}</h2>

        <div class="doctor-specialization">
          <span>{{ doctor().specialisation }}</span>
          <button class="more-btn" (click)="showMoreInfo.emit(doctor())">
            {{ translationService.translate("shared.doctorCard.more") }}
          </button>
        </div>

        <div class="doctor-rating">
          <div class="stars">
            @for (star of [1, 2, 3, 4, 5]; track star) {
              <span class="star" [class.filled]="star <= doctor().rating"
                >★</span
              >
            }
          </div>
          <span class="reviews-count"
            >{{ doctor().reviewsCount }}
            {{
              translationService.translate("shared.doctorCard.opinion")
            }}</span
          >
        </div>
      </div>
    </div>

    <div class="address-section">
      <div class="address-tabs">
        @for (address of doctor().addresses; let i = $index; track i) {
          <button
            class="address-tab"
            [class.active]="i === selectedAddressIndex()"
            (click)="onAddressTabClick(i)"
          >
            {{ translationService.translate("shared.doctorCard.address") }}
            {{ i + 1 }}
          </button>
        }
      </div>

      <div class="current-address">
        {{ doctor().addresses[selectedAddressIndex()].address | addressFormat }}
        <p>
          {{
            doctor().addresses[selectedAddressIndex()].institution
              .institutionName
          }}
        </p>
      </div>
    </div>
  </div>

  <div class="schedule-section">
    @if (isScheduleLoading()) {
      <div class="spinner-container">
        <p-progress-spinner [strokeWidth]="'3'"></p-progress-spinner>
      </div>
    } @else {
      @if (doctor().schedule && doctor().schedule.length > 0) {
        <div class="schedule-days">
          @for (day of getSortedDays(); track day) {
            <div class="day-column">
              <div class="day-header">
                <div class="day-name">{{ day.dayName }}</div>
                <div class="day-date">{{ formatDayDate(day) }}</div>
              </div>

              <div class="time-slots">
                @if (hasPreviousSlots(day.dayName)) {
                  <button class="back-btn" (click)="onShowPreviousHours(day)">
                    <i class="pi pi-arrow-left"></i>
                    Wróć
                  </button>
                }

                @for (
                  slot of getVisibleSlots(day.slots, day.dayName);
                  track slot
                ) {
                  <button
                    class="time-slot"
                    [class.available]="slot.available && !slot.booked"
                    [class.booked]="slot.booked"
                    [class.unavailable]="!slot.available"
                    [disabled]="!slot.available || slot.booked"
                    (click)="onTimeSlotClick(day, slot)"
                  >
                    {{ slot.time }}
                  </button>
                }

                @if (hasMoreSlots(day.slots, day.dayName)) {
                  <button class="more-hours-btn" (click)="onShowMoreHours(day)">
                    {{ getRemainingSlotCount(day.slots, day.dayName) }} więcej
                    <i class="pi pi-angle-right"></i>
                  </button>
                }

                @if (day.slots.length > MAX_VISIBLE_SLOTS) {
                  <div class="page-info">
                    {{ getCurrentPageInfo(day.slots, day.dayName) }}
                  </div>
                }
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="no-schedule">
          {{ translationService.translate("shared.doctorCard.noSchedule") }}
        </div>
      }

      <p-button
        [rounded]="true"
        severity="secondary"
        [outlined]="true"
        (onClick)="showMoreInfo.emit(doctor())"
        icon="pi pi-arrow-right"
      ></p-button>
    }
  </div>
</div>
