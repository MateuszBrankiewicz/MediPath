@if (isLoading()) {
  <div class="spinner-container">
    <p-progress-spinner [style]="{ width: '20%', height: '20%' }">
    </p-progress-spinner>
  </div>
} @else {
  @if (isSending()) {
    <div class="floating-center-spinner">
      <p-progress-spinner
        [style]="{ width: '64px', height: '64px' }"
      ></p-progress-spinner>
    </div>
  }
  <div class="medical-history-container">
    <h3>{{ translationService.translate("patient.medicalHistory.title") }}</h3>
    <app-filter-component
      [style]="{ width: '80%', marginTop: '1rem', marginBottom: '1rem' }"
      (filtersChange)="onFiltersChange($event)"
      [showStatus]="false"
      [showDates]="true"
      [showSort]="true"
      [defaults]="{
        searchTerm: '',
        status: 'all',
        dateFrom: null,
        dateTo: null,
        sortField: 'date',
        sortOrder: 'desc',
      }"
      [autoApply]="true"
    />
    <p-panel class="history-panel">
      <div class="history-list">
        @for (record of filteredRecords(); track record.id) {
          <div class="history-item">
            <div class="history-content">
              <span class="history-text"
                >{{ record.date | date: "dd-MM-yyyy" }} -
                {{ record.title }}</span
              >
            </div>
            <div class="history-actions">
              <p-button
                icon="pi pi-eye"
                class="view-button"
                [text]="true"
                (onClick)="viewRecord(record)"
                pTooltip="View details"
              >
              </p-button>
              <p-button
                icon="pi pi-trash"
                class="delete-button"
                [text]="true"
                severity="danger"
                (onClick)="deleteRecord(record.id)"
                pTooltip="Delete record"
              >
              </p-button>
            </div>
          </div>
        }
      </div>
    </p-panel>
    <div class="add-entry-container">
      <p-button
        [label]="
          translationService.translate('patient.medicalHistory.addEntry')
        "
        class="add-entry-button"
        (onClick)="addNewEntry()"
      >
      </p-button>
    </div>
  </div>
}
