@if (isLoading()) {
  <div class="loading-container">
    <p-progress-spinner></p-progress-spinner>
  </div>
} @else {
  <div class="doctor-info">
    <div class="main-card">
      <p-card>
        <div class="doctor-info-card">
          <img
            [src]="doctorInfo().photoUrl"
            [alt]="'Dr. ' + doctorInfo().name + ' ' + doctorInfo().surname"
          />
          <div class="doctor-personal-information">
            <p class="doctor-name">
              Dr. {{ doctorInfo().name }} {{ doctorInfo().surname }}
            </p>
            <div class="doctor-rating">
              <div class="stars">
                @for (star of [1, 2, 3, 4, 5]; track star) {
                  <span
                    class="star"
                    [class.filled]="star <= doctorInfo().rating.stars"
                    >â˜…</span
                  >
                }
              </div>
              <span class="reviews-count">
                ({{ doctorInfo().rating.opinions }} opinions)
              </span>
            </div>
            <span class="pwz-info">PWZ: {{ doctorInfo().pwz }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="institution-card">
      <p-card>
        <div class="card-title">Institutions</div>
        <ul>
          @for (institution of doctorInfo().institutions; track institution) {
            <li>{{ institution.institutionName }}</li>
          }
        </ul>
      </p-card>
    </div>

    <div class="spec-card">
      <p-card>
        <div class="card-title">Specialisation</div>
        <ul>
          @for (spec of doctorInfo().specialisation; track spec) {
            <li>{{ spec }}</li>
          }
        </ul>
      </p-card>
    </div>
  </div>
  <div class="comment-block">
    <div class="tab-list">
      <p-button
        type="button"
        class="tab"
        [text]="true"
        [class.active]="selectedTabIndex() === 0"
        (click)="setSelectedTabIndex(0)"
      >
        Comments
      </p-button>
      <p-button
        type="button"
        class="tab"
        [text]="true"
        [class.active]="selectedTabIndex() === 1"
        (click)="setSelectedTabIndex(1)"
      >
        Schedule
      </p-button>
    </div>

    @if (selectedTabIndex() === 0) {
      <div [style]="{ overflow: 'auto' }">
        <div class="comment-content">
          @for (comment of doctorInfo().comments; track comment.id) {
            <app-patient-comment-component [comment]="comment" />
          }
        </div>
      </div>
    } @else {
      <div class="tab-panel">
        <div class="doctors-instutions">
          <h4>Choose institution:</h4>
          @for (institution of doctorInfo().institutions; track institution) {
            <p-card
              class="institution-chip"
              [style]="{
                cursor: 'pointer',
                background:
                  selectedInstitution() === institution ? '#cce5ff' : '#f8f9fa',
              }"
              [header]="institution.institutionName"
              (click)="selectInstitution(institution)"
              [class]="selectedInstitution() === institution ? 'selected' : ''"
            ></p-card>
          }
        </div>

        <div class="calendar-schedule-wrapper">
          <app-calendar-schedule
            [size]="'small'"
            [availableAppointments]="mappedSchedule()"
            (dateTimeSelected)="selectSlotId($event)"
          ></app-calendar-schedule>
          @if (isScheduleLoading() && !isLoading()) {
            <div class="calendar-spinner-overlay">
              <p-progress-spinner></p-progress-spinner>
            </div>
          }
        </div>
        <div class="remarks-with-schedule">
          <textarea
            pTextarea
            class="appointment-description"
            placeholder="Appointment description..."
            [(ngModel)]="patientRemarks"
            [rows]="10"
          ></textarea>
          <p-button
            type="button"
            label="Book appointment"
            (onClick)="bookVisit()"
            [disabled]="!selectedInstitution() && !selectedId()"
          />
        </div>
      </div>
    }
  </div>
}
