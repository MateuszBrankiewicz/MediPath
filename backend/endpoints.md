# Backend Endpoint List

### /cities/{name}

#### Method: GET

#### Path Variables:
- name: Optional parameter. If left blank, a list of all cities in the database will be returned. Otherwise,
            all entries containing the value will be returned, for example /api/cities/Lub will return Lublin and Lubin.

#### Returns: 
- 200 - Array of cities matching the query. Can be empty.


### /users/register

#### Method: POST

#### Body:

- name -First name
- surname - Last name
- email - Email
- govID - Government ID number
- birthDate - Date of birth. Format "dd-MM-yyyy"
- province - Province
- city - City
- postalCode - Postal Code,
- phoneNumber - Phone number. Saved as a String to ensure compatibility with international formats
- street - Street name
- number - Street number. Saved as a String to ensure compatibility with all formats, such as "street_number flat_number"
- password - plain-text password


### Returns:

- 400 - Missing fields in body
- 409 - this email or person is already registered
- 200 - Success


### /users/login

#### Method: POST
#### Body:
- email
- password

#### Returns:

- 400 - Missing fields in request body
- 401 - Invalid email or password
- 200 - Success


### /users/logout

#### Method: GET

#### Returns:
- 200 - success


### /users/resetpassword?address=

#### Method: GET
#### Parameters:
- address: email address for the account reset

#### Returns:

- 400 - Missing address in request parameters
- 500 - the mail service threw an error, error in response
- 200 - password reset mail has been sent, if the account exists


### /users/resetpassword

#### Method: POST
#### Body: 
- token - Password reset token generated by the GET endpoint and sent via mail
- password - The new password


#### Returns:
- 400 - Missing fields in body
- 410 - Token invalid or expired
- 500 - invalid user referenced by token. Only possible if the email referenced by the token has been corrupted or changed manually after the password reset request has been sent.
- 200 - Password reset successfully


### /search/{query}?type=type
#### Method: GET
#### Path Variables:
- query: String that gets looked in the database. Can match to name or surname of a doctor or name of an institution, depending on the "type" variable. If ommitted, will match any name.

#### Parameters:
- type: Determines which collection to search with the given query. Accepted values are "doctor" or "institution". Required
- city: city and province to restrict the search results to. Syntax: "city,province". Not required.
- specialisations: specialisations to restrict the search results to. Syntax: specialisation names separated by a comma. Not required.

#### Returns:

- 400 - unknown type, value different than doctor or institution
- 200 - success, returns search results or empty



### /visits/add
#### Method: POST
#### Body:
- scheduleID: object ID of the schedule to which a given visit will be assigned
- patientRemarks - note to attach to visit from patient's side

#### Returns:

- 400 - Missing fields in request body, visit time is invalid or booked
- 201 - success


### /schedules/add
#### Method: POST

#### Body:
- doctorID: doctor's user id
- institutionID: institution's ID
- startTime: schedule start time (yyyy-MM-dd HH:mm:ss)
- endTime: schedule end time (yyyy-MM-dd HH:mm:ss)

#### Returns:

- 403 - doctor's user id is invalid, institution id is invalid, user is not logged in as staff of institution or doctor does not belong to institution
- 409 - this doctor is booked at this hour - schedule overlaps with another for a given doctor
- 201 - success


### /doctors/{id}
#### Method: GET

#### Path Variables:
- id: id of the doctor

#### Request parameters:
- fields: Array of fields to return. accepted values are id, name, surname, licence_number, specialisations and employers.

#### Returns:

- 400 - invalid user id - user with a given id does not exist or is not a doctor
- 200 - success, retrieves the doctor object with fields specified in the "fields" parameter


### /institution/add
#### Method: POST

#### Body:
- name: name of the institution
- isPublic: whether the institution is public or private
- address: address of the institution. Is an object with fields: province, city, street, number and postalCode
- image: Base64 image of the institution

#### Returns:
- 401 - user is not logged in
- 403 - user is not admin
- 400 - missing fields in request body
- 409 - this institution is a possible duplicate - An institution with the same name and a very close address is already registered
- 201 - success


### /institution/{institutionid}/employees/
#### Method: POST
#### Path Variables:
- institutionid: objectid of the institution

#### Body: Array of employee forms

#### Employee form:
- userID: objectid of the user to add
- rolecode: integer - role to assign to the user within the institution 2 - doctor, 4 - staff, 8 - admin. Roles may be combined
- specialisations: array of strings - if user is a doctor, this list contains specialisations which the doctor uses in the given institution

#### Returns:

- 400 - list of users is empty, invalid institution id, one or more user IDs is invalid
- 200 - success


### /institution/{id}
#### Method: GET

#### Path variables:
- id - object id of the institution

#### Parameters:
- fields - array of strings - specifies fields to return inside of the response. Accepted values are "id", "name", "types", "isPublic", "address", "employees", "rating" and "image"

#### Returns:

- 400 - invalid institution id
- 200 - success, returns an institution object containing all fields specified in the fields parameter or all if omitted


### /visits/{id}
#### Method: DELETE
 
#### Path variables:
- id - object id of the visit

#### Returns:
- 401 - User is not logged in
- 403 - user is not the patient from the visit, a staff member from the institution listed in the visit or the visit with this ID does not exist
- 400 - this visit is completed/cancelled
- 200 - success


### /users/me/codes/{codeType}
#### Method: GET

#### Path variables:
- codeType - specifies the code type to return. Accepted values are "prescriptions" and "referrals". If ommitted, will output both types of codes.

#### Returns:
- 401 - User is not logged in
- 400 - invalid code type - not prescription or referral
- 500 - if the schedule id inside the visit is invalid, the server is programmed to throw a 500.
- 200 - success, returns a list of objects containing active codes and their code types


### /visits/{visitid}/reschedule
#### Method: PUT

#### Path variables:
- visitid - objectid of the visit to reschedule

#### Parameters:
- newschedule - object id of the new schedule to rebook the visit to

#### Returns
- 401 - user is not logged in
- 403 - visitid is invalid or the user is not the patient assigned to the visit or a member of staff of the institution specified in the visit
- 400 - this visit is completed or cancelled, invalid new schedule id or schedule is booked
- 500 - if the schedule id inside of the visit is invalid, the server is programmed to throw a 500.
- 200 - visit rebooked successfully


### /users/me/visits
#### Method: GET

#### Parameters:
- upcoming - if ommitted, the method returns all visits. If not blank, returns only upcoming visits

#### Returns:

- 401 - User is not logged in
- 200 - success returns either all or upcoming visits for a given user, depending on the "upcoming" parameter


### /comments/add
#### Method: POST

#### Request body:
- visitID: Object id of the visit which a given comment is for
- institutionRating: a rating for the institution. accepted values are between 1 and 5 in increments of 0.5
- doctorRating: a rating for the doctor. accepted values are between 1 and 5 in increments of 0.5
- comment: the written content of the comment


#### Returns:

- 401 - User is not logged in
- 400 - invalid doctor/institution rating - the rating provided does not fit within specified bounds
- 403 - provided visit Id is invalid or the user is not the patient from the visit
- 500 - The institution or doctor specified within the visit object under the specified visitID is invalid. This could mean some kind of database corruption
- 201 - comment successfully created


### /comments/{id}
#### Method: GET

#### Path variables:
- id - object id of the comment


#### Returns:

- 401 - user is not logged in
- 400 - invalid comment id
- 200 success. Returns:
    - id - object id of the comment
    - author - name and surname of the author
    - doctor - name and surname of the doctor
    - institution - name of the institution
    - doctorRating - a float describing the rating given to the doctor, ranging between 1 and 5
    - institutionRating - a float describing the rating given to the institution, ranging between 1 and 5
    - content - the written part of the comment

### /users/me/comments
#### Method: GET

#### Returns:

- 401 - user is not logged in
- 200 - success. Returns:
    comments - a list of comments with the same syntax as /comments/{id}

### /visits/{visitid}/complete
#### Method: PUT

#### Path variables:
- visitid - object id of the visit

#### Body:
- prescriptions: Array of strings containing codes for prescriptions
- referrals: Array of strings containing codes for referrals
- note: String containing a note for the patient from the doctor

#### Returns:
- 401 - Not logged in
- 403 - When visit id invalid or user does not have access (not logged in as the doctor in charge of a visit)
- 400 - When visit is already completed or cancelled
- 200 - Success



### /ws/

### Type: Websocket

Connect to this websocket to receive notifications. Afterwards, subscribe to /user/notifications to receive user notifications and /system/notifications to receive system notifications


### /users/me/settings
#### Method: GET

#### Returns:
- 401 - User is not logged in
- 200 - Success


### /users/me/settings
#### Method: PUT

#### Body:
- language: Code of the language (such as PL or EN)
- systemNotifications - boolean. Marks whether to allow system notifications (such as visit reminders)
- userNotifications - boolean. Marks whether to allow other notifications (reminders created by the user or doctor)

### Returns:
- 401 - User is not logged in
- 200 - Successfully updated settings or no changes made


### /users/me/update
#### Method: PUT

#### Body:
- city - city name
- name - first name
- surname - last name
- province - province of the address
- postalCode - zip code
- number - street number
- street - street name
- phoneNumber - phone number
- profilePicture - profile picture

#### Returns:
- 401 - User is not logged in
- 200 - Success or no changes


### /users/me/defaultpanel/{panel}
#### Method: PUT

#### Path variables:
- panel - integer describing the default panel to display. Same as the role code (1 - patient, 2 - doctor, 4 - staff, 8 - admin)

#### Returns:
- 401 - User is not logged in
- 403 - User does not have access to this role
- 400 - Invalid panel id (panel id is not either 1, 2, 4 or 8)
- 200 - Success


### /users/me/resetpassword/
#### Method: POST

#### Body:
- currentPassword - current password belonging to the logged-in user
- newPassword - new password to set to the currently logged-in user

#### Returns:
- 401 - User is not logged in or currentPassword is invalid
- 503 - Mail service threw an error
- 200 - Password successfully reset


### /medicalhistory/{id}
#### Method: DELETE

#### Path variables;
- id - object id of the medical history entry to delete

#### Returns:
- 401 - User not logged in
- 403 - Entry does not exist, user does not have access or entry is created by doctor
- 200 - Success


### /medicalhistory/add
#### Method: POST

#### Body:
- userId - id of the user to add the medical history entry to. If omitted, add to your profile,
- title
- note - content
- date - yyyy-mm-dd
- doctor - if adding to another user, this is required, contains the following fields
    - userId - doctor's user id,
    - doctorName 
    - doctorSurname 
    - specialisations - array of strings with specialisations

#### Returns:
- 401 - User not logged in
- 403 - Entry does not exist, user does not have access or entry is created by doctor
- 200 - Success


### /medicalhistory/{id}
#### Method: PUT

#### Body:
- title - title of the visit
- note - note attached to the visit
- date - date of adding - yyyy-mm-dd

#### Returns:
- 401 - User not logged in
- 400 - Missing fields in request body
- 403 - User specified in entry does not exist, user is not logged in as specified patient/doctor or doctor has not had any visits with the patient
- 200 - Success

### /users/me/medicalhistory
#### Method: GET

#### Returns:
- 401 - User not logged in
- 200 - Success


### /users/patients/{patientid}
#### Method: GET

#### Path Variables:
- patientid - object id of the patient's profile

#### Returns:
- 401 - User is not logged in
- 403 - Patient's profile does not exist, User is not a doctor or staff or patient has not visited any institution where user is employed
- 200 - Success


### /doctors/me/schedules
#### Method: GET

#### Returns:
- 401 - User is not logged in
- 403 - User is not a doctor
- 200 - Success


### /visits/code
#### Method: PUT

#### Body:
- codeType - PRESCRIPTION or REFERRAL
- code - 4 digit code


#### Returns:
- 401 - User is not logged in
- 404 - Code not found
- 200 - Success


### /visits/code
#### Method: DELETE

#### Body:
- codeType - PRESCRIPTION or REFERRAL
- code - 4-digit code


#### Returns:
- 401 - User is not logged in
- 404 - Code not found
- 200 - Success


### /comments/{id}
#### Method: PUT

#### Body:
- institutionRating - new rating of the institution. Same rules as when adding
- doctorRating- new rating of the doctor. Same rules as when adding
- comment - text comment

#### Returns:
- 401 - User not logged in
- 400 - Invalid grade
- 403 - comment by this id does not exist or does not belong to the user
- 500 - institution or doctor ID referenced by the comment are invalid. Possible data corruption
- 200 - Success



### /comments/{id}
#### Method: DELETE

#### Returns:
- 401 - User not logged in
- 403 - comment by this id does not exist or does not belong to the user
- 500 - institution or doctor ID referenced by the comment are invalid. Possible data corruption
- 200 - Success


### /users/{id}/getpfp
#### Method: GET

#### Path variables:
- id - target user's id

#### Returns:
- 401 - User is not logged in
- 200 - User's profile picture or empty if user does not exist or does not have one


### /schedules/addmany
#### Method: POST

#### Body:
- doctorID: doctor's user id
- institutionID: institution's ID
- startTime: start time (yyyy-MM-dd HH:mm:ss)
- endTime: end time (yyyy-MM-dd HH:mm:ss)
- interval: length of the visit (HH:mm:ss)

#### Returns:
- 401 - User not logged in
- 403 - Doctor id invalid, institution id invalid, user is not staff of institution or doctor does not belong to institution
- 409 - doctor is booked at this hour
- 201 - success



### /schedules/{scheduleid}
#### Method: PUT

#### Body:
- startTime - new start time
- endTime - new end time

#### Path variables
- scheduleid - object id of the schedule


#### Returns:
- 401 - User is not logged in
- 403 - Schedule id does not exist or user does not have access to it
- 400 - missing fields in request body or schedule is already booked
- 409 - doctor already has schedules within this timeframe
- 200 - success


### /schedules/{scheduleid}
#### Method: DELETE

#### Path variables
- scheduleid - object id of the schedule


#### Returns:
- 401 - User is not logged in
- 403 - Schedule id does not exist or user does not have access to it
- 400 - schedule is already booked
- 200 - success


### /institution/{institutionid}
#### Method: PUT

#### Path Variables:
- institutionid - object id of the institution

#### Returns:
- 401 - User is not logged in
- 403 - Institution does not exist or user is not administrator of institution
- 400 - missing fields in request body
- 410 - Institution with the same name and similar address exists
- 200 - success


### /institution/{institutionid}/employee/{userid}
#### Method: DELETE

#### Path variables:
- institutionid - institution's object id
- userid - employee's user id

#### Returns:
- 401 - User is not logged in
- 403 - Institution does not exist, user is not administrator of institution, employee does not exist or employee is not in institution
- 400 - User is trying to delete himself from employee list
- 200 - success


### /institution/{institutionid}/employee/
#### Method: PUT

#### Path variables:
- institutionid - institution's object id

#### Body:
- userID - id of the user to edit
- roleCode - code of the role to give to the user within the institution
- specialisations - specialisations to give to the doctor within institution

#### Returns:
- 401 - User is not logged in
- 403 - Institution does not exist, user is not administrator of institution, employee does not exist or employee is not in institution
- 400 - User is trying to remove his administrator privileges
- 200 - success

### /institution/{institutionid}/doctors/
#### Method: GET

#### Path variables:
- institutionid - institution's object id


#### Returns:
- 400 - invalid institution id
- 200 - success, returns doctors and schedules


### /visits/{id}
#### Method: GET

#### Path Variables:
- id - visit id

#### Returns:
- 401 - User is not logged in
- 403 - visit id does not exist or user is not either the patient, doctor or staff
- 200 - success


### /institution/{institutionid}/upcomingvisits/
#### Method: GET

#### Path variables:
- institutionid - institution's object id


#### Returns:
- 401 - User is not logged in
- 403 - Institution does not exist or user is not staff in institution
- 200 - success


### /visits/{id}
#### Method: GET

#### Path variables:
- id - Object id of the institution

#### Returns:
- 401 - User not logged in
- 403 - visit does not exist, user is not doctor, staff or patient
- 200 - success


### /comments/doctor/{id}
#### Method: GET

#### Path variables:
- id - Object id of the doctor

#### Returns:
- 200 - returns 200 if institutiton does not exist, has no comments or has comments


### /comments/institution/{id}
#### Method: GET

#### Path variables:
- id - Object id of the institution

#### Returns:
- 200 - returns 200 if institutiton does not exist, has no comments or has comments


### /notifications/read/
#### Method: POST

#### Body:
- timestamp - timestamp of the notification
- title - title of the notification

#### Returns:
- 401 - User not logged in
- 403 - user does not exist
- 200 - success


### /notifications/readall/
#### Method: POST


#### Returns:
- 401 - User not logged in
- 403 - user does not exist
- 200 - success


### /doctors/{doctorid}/schedules/
#### Method: GET

#### Path variables:
- doctorid - Object id of the doctor

#### Parameters
- institution - object id of the institution to filter the schedules by


#### Returns:
- 404 - doctor not found, institution not found if specified or doctor is not employed in institution
- 200 - success


### /users/me/notifications
#### Method: GET

#### Parameters
- filter - optional. Acccepted values are "received" and "upcoming"

#### Returns:
- 401 - user not logged in
- 400 - invalid filter
- 200 - success


### /doctors/{id}/institutions/
#### Method: GET

#### Path variables:
- doctorid - Object id of the doctor


#### Returns:
- 400 - doctor not found
- 200 - success


### /institution/{institutionid}/upcomingvisits/
#### Method: GET

#### Path variables:
- institutionid - Object id of the institution


#### Returns:
- 401 - user not logged in
- 403 - user is not staff of institution or institution does not exist
- 200 - success


### /notifications/add
#### Method; POST

#### Body:
- userId - user's object Id. If ommitted, userId becomes currently logged in user's id
- content - notification content, not requited
- title - notification title, required
- startDate - date of first notification in batch, required, syntax yyyy-mm-dd
- endDate - date of last notification in batch, not required. If ommitted, only one notification is added
- reminderTime - hour of notification, required, syntax hh:mm

#### Returns:
- 401 - User not logged in
- 403 - User with given id does not exist, user logged in has not had any visits with patient
- 400 - start date is not set in the future, end date is before start date
- 201 - success

### /users/profile
#### Method: GET

#### Returns:
- 401 - User is not logged in or user does not exist
- 200 - ok


### /doctors/{id}
#### Method: PUT

#### Path Variables:
- id - object id of the doctor

#### Returns:
- 401 - User is not logged in
- 403 - doctor not found, user is not admin, user specified in doctorid is not doctor
- 400 - missing fields in request body
- 200 - success

### /users/me/institutions
#### Method; GET

#### Parameters:
- role - defines the role to filter the institutions by. Can be either staff or admin

#### Returns:
- 401 - User is not logged in
- 400 - Bad role name
- 200 - Success or empty

### /doctors/me/visits/{date}
#### Method: GET

#### Path variables
- date - date to retrieve the visits from. Accepted values are either 'today' or a date in the dd-mm-yyyy format. If omitted, retrieves all visits

#### Returns:
- 401 - User is not logged in
- 403 - invalid user or user is not doctor
- 400 - invalid date
- 200 - success

### /schedules/updatemany
#### Method; PUT

#### Body:
- doctorID - doctor's user id
- institutionID - institution's id
- startHour - old start hour
- endHour - old end hour
- newStartHour - new start hour
- newEndHour - new end hour 
- newInterval - new length of a visit

#### Returns:
- 401 - user not logged in
- 403 - user is not employee of institution, doctor does not exist, institution does not exist, doctor is not part of institution
- 400 - missing fields in request body, new schedule overlaps, time period contains schedules for multiple institutions
- 500 - doctor or institution with given id have no profile
- 200 - success


### /institution/{institutionid}/schedules/{date}
#### Method: GET

#### Path variables
- institutionid - id of the institution
- date - month and year to filter the schedules by. Can be either "now" (will automatically fill the current month and year) or a date in the mm-yyyy format

#### Returns:
- 401 - user is not logged in
- 403 - user is not admin or staff of institution or institution does not exist
- 400 - invalid date
- 200 - success


### /institution/{id}/employee/register
#### Method: POST

#### Path Variables:
- id - institution id

#### Body:
```
"userDetails": {
    name: String,
    surname: String,
    email: Email
    govID: String
    birthDate: DD-MM-YYYY
    province: String
    city: String
    postalCode: XX-XXX
    phoneNumber: String,
    street: String
    number:  String
},
roleCode: int,
doctorDetails: {
    licenceNumber: String
    specialisations: [String]
}
```
#### Returns:
- 401 - User not logged in
- 403 - Institution does not exist, user is not admin of institution
- 400 - missing fields
- 409 - Account with this mail or govId exists
- 503 - mail error
- 201 - success


### /user/{id}/medicalhistory/
#### Method: GET

#### Path variables:
- id - patient's id

#### Returns:
- 401
- 403 - Invalid patient, not a doctor, doctor did not have any visits with patient
- 200

### /doctors/me/patients/
#### Method: GET

#### Returns:
- 401
- 403 - User not a doctor
- 200


### /notifications/
#### Method: DELETE

#### Body:
- title - title of the notifications to remove
- reminderTime - time a notification occurs at
- startDate - first date to start deleting notifications from
- endDate - last date to delete notification at

#### Returns:
- 401
- 400 - missing field or no notification matches criteria
- 200 - success


### /users/me/deactivate
#### Method: POST

#### Description:
Permanently deactivates your account. If employed at any institution, get automatically removed from each.

### Returns:
- 200
- 401 - not logged in
- 409 - is last remaining admin of an institution
- 403 - already deactivated

### /institution/{id}/deactivate
#### Method: POST

#### Description:
Permanently deactivates an institution. All employees are removed.

#### Returns:
- 200
- 401 - not logged in
- 400 - invalid id
- 403

### /users/find/{govid}
#### Method: GET

#### Description:
Find a user by their government ID number

#### Path variables:
- govid - user's government id number

#### Returns:
- 401
- 403 - user is not admin
- 400 - invalid user
- 200
